contactPoints:
  - orgId: 1
    name: grafana-default-email
    receivers:
      - uid: grafana-default-email
        type: email
        settings:
          addresses: "tarmo.hiltunen@contrasec.fi"
          disableResolveMessage: true
groups:
  - orgId: 1
    name: security_events
    folder: security_events
    interval: 60s
    rules:
      - uid: attack01
        title: Attack
        condition: B
        data:
          - refId: A
            queryType: range
            relativeTimeRange:
              from: 900
              to: 0
            datasourceUid: '-100'
            model:
              editorMode: code
              expr: sum by (attacker, Server, server, value) (count_over_time({job="ingress-controller/ingress-nginx"} |= "transaction" |= "severity" |= "match" |= "ruleId" | json attacker="transaction.client_ip",time="transaction.time_stamp", Server="transaction.request.headers.Host", server="transaction.request.headers.host" | __error__="" [$__interval]))
              hide: false
              intervalMs: 1000
              legendFormat: "{{attacker}} {{Server}} {{server}}{{value}}"
              maxDataPoints: 43200
              queryType: range
              refId: A
              resolution: 1
          - refID: B
            queryType: ''
            relativeTimeRange:
                from: 0
                to: 0
                datasourceUid: "-100"
            model:
              conditions:
              - evaluator:
                  params:
                  - 5
                  type: gt
                operator:
                  type: when
                query:
                  params:
                  - A
                reducer:
                  params: []
                  type: count
                type: query
              datasource:
                type: __expr__
                uid: "-100"
              expression: A
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              reducer: count
              refId: B
              settings:
                mode: ''
              type: reduce
        noDataState: OK
        execErrState: OK
        for: 10m
        annotations:
          summary: |-
            Attacker: {{ $labels.attacker }}
            URL: {{ $labels.server }}{{ $labels.Server }}

